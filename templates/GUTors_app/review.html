{% extends 'GUTors_app/base.html' %}

{% load static %}

{% block title_block %}
  {% if session %}Review Session with {{ session.tutor.user.username }}{% else %}Reviews{% endif %}
{% endblock %}

{% block head_extra %}
  {{ block.super }}
  <script src="{% static 'js/sessionActions.js' %}"></script>
{% endblock %}

{% block body_block %}
<div class="container">
  {% if session %}
    <!-- Single session review mode -->
    <h1 class="text-center mb-4">Review Session</h1>
    
    <!-- Include the session card for the current session -->
    {% include "GUTors_app/session_card.html" with session=session %}
    
    <div class="card mb-4">
      <div class="card-header bg-uni-blue">
        <h3 class="mb-0">Your Review</h3>
      </div>
      <div class="card-body">
        <form method="post" action="{% url 'GUTors:review_session' session.id %}">
          {% csrf_token %}
          <div class="form-group">
            <label for="id_rating"><strong>Rating:</strong></label>
            {{ form.rating }}
          </div>
          <div class="form-group">
            <label for="id_comment"><strong>Comment:</strong></label>
            {{ form.comment }}
          </div>
          <div class="form-group">
            <button type="submit" class="btn btn-uni-blue">{% if is_edit %}Update{% else %}Submit{% endif %} Review</button>
            <a href="{% url 'GUTors:profile' session.tutor.user.username %}" class="btn btn-outline-uni-blue">Cancel</a>
          </div>
        </form>
      </div>
    </div>
  {% else %}
    <!-- List of all sessions -->
    <h1 class="text-center mb-4">Your Sessions to Review</h1>

    {% for session in sessions %}
      <!-- Include session card with custom actions block for each session -->
      {% include "GUTors_app/session_card.html" with session=session actions=True %}
    {% empty %}
      <div class="alert alert-warning">
        You haven't attended any sessions yet.
      </div>
    {% endfor %}
    
    <h2 class="mb-4">Your Reviews</h2>
    {% with review_title="Your Reviews" review_list=reviews %}
      {% include "GUTors_app/review_display.html" %}
    {% endwith %}
  {% endif %}
</div>
{% endblock %}